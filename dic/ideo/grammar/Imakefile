/* $Id: Imakefile,v 1.13 1996/11/27 07:14:45 kon Exp $ */
#include "../../../Canna.conf"

#ifdef __EMX__
      CANNAROOT = ..\\..\\..
    CANNACMDDIR = $(CANNAROOT)\\cmd

         FORCPP = $(CANNACMDDIR)\\forcpp\\forcpp
        FORSORT = $(CANNACMDDIR)\\forsort\\forsort
           SORT = gsort
#else
      CANNAROOT = ../../..
    CANNACMDDIR = $(CANNAROOT)/cmd

         FORCPP = $(CANNACMDDIR)/forcpp/forcpp
        FORSORT = $(CANNACMDDIR)/forsort/forsort
           SORT = sort
#endif

#ifdef __EMX__
        CRXGRAM = $(CANNACMDDIR)\\crxgram\\crxgram
         CRXDIC = $(CANNACMDDIR)\\crxdic\\crxdic
         CRFREQ = $(CANNACMDDIR)\\crfreq\\crfreq
          MERGE = $(CANNACMDDIR)\\mergewd\\mergeword
        FORSORT = $(CANNACMDDIR)\\forsort\\forsort
         FORCPP = $(CANNACMDDIR)\\forcpp\\forcpp
#else
        CRXGRAM = $(CANNACMDDIR)/crxgram/crxgram
         CRXDIC = $(CANNACMDDIR)/crxdic/crxdic
         CRFREQ = $(CANNACMDDIR)/crfreq/crfreq
          MERGE = $(CANNACMDDIR)/mergewd/mergeword
        FORSORT = $(CANNACMDDIR)/forsort/forsort
         FORCPP = $(CANNACMDDIR)/forcpp/forcpp
#endif

    CANNADICDIR = $(DicDir)/canna

         ALLDIC = $(DICOBJS)
#ifdef USE_OBSOLETE_STYLE_FILENAME
        DICOBJS = fuzokugo.d fuzokugo.fq
#else
        DICOBJS = fuzokugo.cbd fuzokugo.cld
#endif
           OBJS = cpp.gram cnj.swd cnj.bits cnj.h cnj.mac fuzokugo.swd

        DEFINES = -USX /* for SX3 */

AllTarget($(ALLDIC))

cpp.gram: gram.code gram.goto main.code
	$(FORCPP) -7 < gram.code | \
		$(CPP) $(DEFINES) | \
		$(FORCPP) -8 > cpp.gram

cnj.swd cnj.bits cnj.h cnj.mac: cpp.gram 
		$(CRXGRAM) -f cpp.gram

fuzokugo.swd: cnj.swd
	$(FORSORT) -7 < cnj.swd | \
		$(SORT) | \
		$(FORSORT) -8 | \
		$(MERGE) > fuzokugo.swd

fuzokugo.d: fuzokugo.swd cnj.bits
	$(CRXDIC) -s -o fuzokugo.d -D cnj.bits -n fuzokugo fuzokugo.swd
	cat cnj.bits >> fuzokugo.d

fuzokugo.cbd: fuzokugo.swd cnj.bits
	$(CRXDIC) -s -o fuzokugo.cbd -D cnj.bits -n fuzokugo fuzokugo.swd
	cat cnj.bits >> fuzokugo.cbd

fuzokugo.cld: fuzokugo.cbd
	$(CRFREQ) -o fuzokugo.cld fuzokugo.cbd fuzokugo.swd

fuzokugo.fq: fuzokugo.d
	$(CRFREQ) -o fuzokugo.fq fuzokugo.d fuzokugo.swd

clean::
	$(RM) $(DICOBJS) $(OBJS)

depend::

MakeDirectories(install,$(CANNADICDIR))

InstallMultipleFlags($(ALLDIC),$(CANNADICDIR),-m 0664 $(cannaOwnerGroup))

install::
	$(CHGRP) $(cannaGroup) $(CANNADICDIR)
	$(CHOWN) $(cannaOwner) $(CANNADICDIR)
	$(CHMOD) ug+w $(CANNADICDIR)
